# vi: ft=sh sts=2 ts=2 sw=2 et

# http://wiki.bash-hackers.org/scripting/bashchanges
set -o vi noclobber

shopt_enabled=(
  # glob
  dotglob
  failglob                 # don't pass failed globs
  nocaseglob

  # history
  cmdhist                  # put multiline commands into history
  histappend
  histverify

  # strangely custom
  cdspell
  gnu_errfmt
  no_empty_cmd_completion
  
  # defaults
  expand_aliases
  extquote
  interactive_comments
  progcomp
  promptvars
)

shopt_disabled=(
  # turned off defaults
  checkwinsize    #  DANGER: update LINES and COLUMNS after each command
  hostcomplete    #  triggers on @
  extglob         #  strange quanitfiers with groups
  cdable_vars     #  if cd arg does not match, search env vars (was $ hard to type?)
  sourcepath

  # default offs
  execfail
  huponexit
  lithist
  mailwarn
  nocasematch
  nullglob
  shift_verbose
  xpg_echo
)


if [[ "$BASH_VERSINFO" -ge 4 ]]; then
  shoptions+=(
    checkhash
    checkjobs
    dirspell
    complete_fullquote
    lastpipe
  )
  shopt_disabled+=(
    globstar
    direxpand
  )
fi

shopt -s ${shopt_enabled[@]}
shopt -u ${shopt_disabled[@]}
unset shopt_enabled shopt_disabled

source_if_exists () {
  if [[ -f "$1" ]]; then
    . "$1"
    return 0
  fi
  return 1
}

source_any () {
  while [[ $# -gt 0 ]]; do
    source_if_exists "$1" && return 0
    shift
  done
  return 1
}

. ~/.config/bash/git.bash
. ~/.config/bash/prompt.bash
. ~/.config/bash/aliases.bash
. ~/.config/bash/buku-completion.bash
source_if_exists ~/.config/bash/os-aliases.bash
eval "$(dircolors -b ~/.config/bash/dircolors/dircolors.256dark) 2>/dev/null >/dev/null"

[[ -z "$HOSTNAME" ]] && HOSTNAME="$(hostname)"
HOSTIDENT="$(printf '%s' "$HOSTNAME" | sed 's/\..*//')"
source_if_exists ~/.config/bash/hosts/"${HOSTIDENT}.sh"
source_if_exists ~/.config/bash/hosts/"${HOSTIDENT}.private.sh"
source_if_exists ~/.config/bash/hosts/local.private.sh
unset HOSTIDENT

# Completion is bloody broken in fzf @ 45d4c57
# source_if_exists ~/.fzf/shell/completion.bash 2>/dev/null
source_if_exists ~/.fzf/shell/key-bindings.bash 2>/dev/null
